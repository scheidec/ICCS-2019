map2(original_vars, bin_vars, ~ tbl1 %>% count(!!sym(.x), !!sym(.y)))
# Chunk 8
tbl1 %>%
count(GENDER)
# Chunk 9
# recode
tbl1 <- tbl1 %>%
mutate(FEMALE_bin = fct_collapse(GENDER,
"0" = "(0) Male",
"1" = "(1) Female"))
# confirm correct recode
tbl1 %>%
count(FEMALE_bin, GENDER)
# Chunk 10
tbl1 %>%
count(BSGBOOK)
# recode
tbl1 <- tbl1 %>%
mutate(BSGBOOK_3 = fct_collapse(BSGBOOK,
"0 to 50" = c("(1) None", "(2) 1 - 10", "(3) 11 - 50"),
"51-200" = c("(4) 51 - 100", "(5) 101 - 200"),
"201+" = "(6) More than 200)"))
# confirm correct recode
tbl1 %>%
count(BSGBOOK_3, BSGBOOK)
tbl1 %>%
count(BSGBOOK)
tbl3 %>%
count(IS3G11)
# recode
tbl1 <- tbl1 %>%
mutate(BSGBOOK_4 = fct_collapse(BSGBOOK,
"0-10   = c("(1) None", "(2) 1 - 10"),
"11-100" = c("(3) 11 - 50","(4) 51 - 100"),
"101-200" = "(5) 101 - 200"),
"201+" = "(6) More than 200)"))
# confirm correct recode
tbl1 %>%
count(BSGBOOK_4, BSGBOOK)
# recode
tbl1 <- tbl1 %>%
mutate(BSGBOOK_4 = fct_collapse(BSGBOOK,
"0-10 = c("(1) None", "(2) 1 - 10"),
"11-100" = c("(3) 11 - 50","(4) 51 - 100"),
"101-200" = "(5) 101 - 200"),
"201+" = "(6) More than 200)")))
# confirm correct recode
tbl1 %>%
count(BSGBOOK_4, BSGBOOK)
tbl1 %>%
count(BSGBOOK)
# recode
tbl1 <- tbl1 %>%
mutate(BSGBOOK_4 = fct_collapse(BSGBOOK,
"0 to 10 = c("(1) None", "(2) 1 - 10"),
"11-100" = c("(3) 11 - 50","(4) 51 - 100"),
"101-200" = "(5) 101 - 200")
# confirm correct recode
tbl1 %>%
count(BSGBOOK_4, BSGBOOK)
# recode
tbl1 <- tbl1 %>%
mutate(BSGBOOK_4 = fct_collapse(BSGBOOK,
"0 to 10 = c("(1) None", "(2) 1 - 10"),
"11-100" = c("(3) 11 - 50", "(4) 51 - 100"),
"101-200" = "(5) 101 - 200")
# confirm correct recode
tbl1 %>%
count(BSGBOOK_4, BSGBOOK)
# recode
tbl1 <- tbl1 %>%
mutate(BSGBOOK_4 = fct_collapse(BSGBOOK,
"0 to 10 = c("(1) None", "(2) 1 - 10"),
"11-100" = c("(3) 11 - 50", "(4) 51 - 100"),
"101-200" = "(5) 101 - 200"),
"201+" = "(6) More than 200)"))
# confirm correct recode
tbl1 %>%
count(BSGBOOK_4, BSGBOOK)
# recode
tbl1 <- tbl1 %>%
mutate(BSGBOOK_3 = fct_collapse(BSGBOOK,
"0 to 50" = c("(1) None", "(2) 1 - 10", "(3) 11 - 50"),
"51-200" = c("(4) 51 - 100", "(5) 101 - 200"),
"201+" = "(6) More than 200)"))
# confirm correct recode
tbl1 %>%
count(BSGBOOK_3, BSGBOOK)
tbl1 %>%
count(EXPEDUC)
# recode
tbl1 <- tbl1 %>%
mutate(EXPEDUC_3 = fct_collapse(EXPEDUC,
"0 to 4" = c("(0) 0", "(1) 1-2", "(2) 3-4"),
"5-8" = c("(3) 5-6", "(4) 7-8"),
"9+" = c("(5) 9-10", "(6) 10+")))
# confirm correct recode
tbl1 %>%
count(EXPEDUC_3, EXPEDUC)
# recode
tbl1 <- tbl1 %>%
mutate(BSGBOOK_3 = fct_collapse(BSGBOOK,
"0 to 50" = c("(1) None", "(2) 1 - 10", "(3) 11 - 50"),
"51-200" = c("(4) 51 - 100", "(5) 101 - 200"),
"201+" = "(6) More than 200)"))
# confirm correct recode
tbl1 %>%
count(BSGBOOK_3, BSGBOOK)
tbl1 %>%
count(BSGBOOK)
tbl3 %>%
count(IS3G11)
# recode
tbl3 <- tbl3 %>%
mutate(BOOK_3 = fct_collapse(IS3G11,
"0 to 50" = c("(1) None", "(2) 1 - 10", "(3) 11 - 50"),
"51-200" = c("(4) 51 - 100", "(5) 101 - 200"),
"201+" = "(6) More than 200)"))
# confirm correct recode
tbl1 %>%
count(BSGBOOK_3, BSGBOOK)
tbl3 %>%
count(IS3G11)
# recode
tbl3 <- tbl3 %>%
mutate(BOOK_3 = fct_collapse(IS3G11,
"0 to 10" = "(1) None or very few (0–10 books)"),
"11-100"  = c("(2) Enough to fill one shelf (11–25 books)", "(3) Enough to fill one bookcase (26–100 books)"),
"101-200" = "(4) Enough to fill two bookcase (101–200 books)"),
"201+" = "(5) Enough to fill three or more bookcases (more than 200 books"))
# confirm correct recode
tbl3 %>%
count(BOOK_3, IS3G11)
tbl1 %>%
count(BSGBOOK)
# recode
tbl3 <- tbl3 %>%
mutate(BOOK_3 = fct_collapse(IS3G11,
"0 to 10" = "(1) None or very few (0–10 books)"),
"11-100"  = c("(2) Enough to fill one shelf (11–25 books)", "(3) Enough to fill one bookcase (26–100 books)"),
"101-200" = "(4) Enough to fill two bookcase (101–200 books)"),
"201+" = "(5) Enough to fill three or more bookcases (more than 200 books"))
# confirm correct recode
tbl3 %>%
count(BOOK_3, IS3G11)
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE, fig.width = 10)
library(tidyverse)
library(readr)
library(purrr)
library(writexl)
# Chunk 2
# all files
files <- list.files("../data", full.names = TRUE)
# helper function to load files
load_files <- function(file) {
e <- new.env()
load(file, envir = e)
stopifnot(length(e) == 1)  # safety first
get(names(e)[1], envir = e)
}
tbl1 <- files %>%
magrittr::extract(1:28) %>%      # filter to 1999 files only
map(~ .x %>%
load_files() %>%
select(COUNTRY, IDCNTRY, IDSTUD, BS3B1, BS3B11, BS3B9, BS3B4, BS3B13,
BS3B2, BS3B6, BS3B10, BS3B8, BS3B5, BS3B12, BS3B3, GENDER,BSGBOOK, EXPEDUC, BSGEDUM, BSGEDUF, TOTWGT)) %>%
reduce(rbind) %>%
as_tibble() %>%
mutate(`ICCS_year` = 1999) %>%     # add survey year variable
select(`ICCS_year`, everything())
# Chunk 3
original_vars <- tbl1 %>%
select(BS3B1, BS3B11, BS3B9, BS3B4, BS3B13, BS3B2, BS3B6, BS3B10, BS3B8, BS3B5, BS3B12, BS3B3) %>%
colnames()
original_vars %>%
map(~ tbl1 %>% count(!!sym(.x)))
# Chunk 4
# recode
tbl1 <- tbl1 %>%
mutate(BS3B1_binary = fct_collapse(BS3B1,
"not important" = c("(1) not important", "(2) somewhat unimportant"),
"important"     = c("(3) somewhat important", "(4) very important")))
# confirm correct recode
tbl1 %>%
count(BS3B1, BS3B1_binary)
# Chunk 5
tbl1 <-tbl1 %>%
mutate_at(vars(BS3B1, BS3B11, BS3B9, BS3B4, BS3B13, BS3B2, BS3B6, BS3B10, BS3B8, BS3B5, BS3B3),
funs(bin = fct_collapse(.,
"not important"= c("(1) not important", "(2) somewhat unimportant"),
"important"    = c("(3) somewhat important", "(4) very important")))
)
# Chunk 6
# troubleshoot
tbl1 %>% count(BS3B12)
# recode
tbl1 <- tbl1 %>%
mutate(BS3B12_bin = fct_collapse(BS3B12,
"not important" = c("(1) not importnat", "(2) somewhat unimportant"),
"important"     = c("(3) somewhat important", "(4) very important"))
)
# Chunk 7
bin_vars <- original_vars %>%
paste0("_bin")
map2(original_vars, bin_vars, ~ tbl1 %>% count(!!sym(.x), !!sym(.y)))
# Chunk 8
tbl1 %>%
count(GENDER)
# Chunk 9
# recode
tbl1 <- tbl1 %>%
mutate(FEMALE_bin = fct_collapse(GENDER,
"0" = "(0) Male",
"1" = "(1) Female"))
# confirm correct recode
tbl1 %>%
count(FEMALE_bin, GENDER)
# Chunk 10
tbl1 %>%
count(BSGBOOK)
# Chunk 11
# recode
tbl1 <- tbl1 %>%
mutate(BSGBOOK_3 = fct_collapse(BSGBOOK,
"0 to 50" = c("(1) None", "(2) 1 - 10", "(3) 11 - 50"),
"51-200" = c("(4) 51 - 100", "(5) 101 - 200"),
"201+" = "(6) More than 200)"))
# confirm correct recode
tbl1 %>%
count(BSGBOOK_3, BSGBOOK)
# Chunk 12
# recode
tbl1 <- tbl1 %>%
mutate(BSGBOOK_4 = fct_collapse(BSGBOOK,
"0 to 10 = c("(1) None", "(2) 1 - 10"),
"11-100" = c("(3) 11 - 50", "(4) 51 - 100"),
"101-200" = "(5) 101 - 200"),
"201+" = "(6) More than 200)"))
# confirm correct recode
tbl1 %>%
count(BSGBOOK_4, BSGBOOK)
# Chunk 13
tbl1 %>%
count(EXPEDUC)
# Chunk 14
# recode
tbl1 <- tbl1 %>%
mutate(EXPEDUC_3 = fct_collapse(EXPEDUC,
"0 to 4" = c("(0) 0", "(1) 1-2", "(2) 3-4"),
"5-8" = c("(3) 5-6", "(4) 7-8"),
"9+" = c("(5) 9-10", "(6) 10+")))
# confirm correct recode
tbl1 %>%
count(EXPEDUC_3, EXPEDUC)
# Chunk 15
tbl1 %>%
count(BSGEDUM)
# Chunk 16
# recode
tbl1 <- tbl1 %>%
mutate(BSGEDUM_3 = fct_collapse(BSGEDUM,
"(0) Less than HS" = c("(1) no.elem.school", "(2) Fin. elem. sch.", "(3) Fin.s.high sch."),
"(1) HS" = "(4) Fin.high sch.",
"(2) Post-HS" = c("(5) Sme technic.educ. after", "(6) sme college,univ.", "(7) bach. degree")))
# confirm correct recode
tbl1 %>%
count(BSGEDUM_3, BSGEDUM)
# Chunk 17
tbl1 %>%
count(BSGEDUF)
# Chunk 18
# recode
tbl1 <- tbl1 %>%
mutate(BSGEDUF_3 = fct_collapse(BSGEDUF,
"(0) Less than HS" = c("(1) no.elem.school", "(2) Fin. elem. sch.", "(3) Fin.s.high sch."),
"(1) HS" = "(4) Fin.high sch.",
"(2) Post-HS" = c("(5) Sme technic.educ. after", "(6) sme college,univ.", "(7) bach. degree")))
# confirm correct recode
tbl1 %>%
count(BSGEDUF_3, BSGEDUF)
# Chunk 19
tbl1 <- tbl1 %>%
select(ICCS_year,
COUNTRY,
IDSTUD,
TOTWGTS = TOTWGT,
obey    = BS3B1_bin,
rights  = BS3B11_bin,
local   = BS3B9_bin,
work    = BS3B4_bin,
envir   = BS3B13_bin,
vote    = BS3B2_bin,
history = BS3B6_bin,
respect = BS3B10_bin,
news    = BS3B8_bin,
protest = BS3B5_bin,
discuss = BS3B12_bin,
party   = BS3B3_bin,
female  = FEMALE_bin,
books   = BSGBOOK_3,
edexp   = EXPEDUC_3,
ed_mom  = BSGEDUM_3,
ed_dad  = BSGEDUF_3)
tbl1 %>% head()
tbl2 <- files %>%
magrittr::extract(29:66) %>%      # filter to 2009 files only
map(~ .x %>%
load_files() %>%
select(COUNTRY, IDCNTRY, IDSTUD, IS2P21L, IS2P21I, IS2P21H, IS2P21K, IS2P21J, IS2P21A,
IS2P21C, IS2P21E, IS2P21D, IS2P21G, IS2P21F, IS2P21B, IS2G02, IS2G11, IS2G03, IS2G07, IS2G09, TOTWGTS)) %>%
reduce(rbind) %>%
as_tibble() %>%
mutate(`ICCS_year` = 2009) %>%     # survey year variable creation
select(`ICCS_year`, everything())
tbl2 <- files %>%
magrittr::extract(29:66) %>%      # filter to 2009 files only
map(~ .x %>%
load_files() %>%
select(COUNTRY, IDCNTRY, IDSTUD, IS2P21L, IS2P21I, IS2P21H, IS2P21K, IS2P21J, IS2P21A,
IS2P21C, IS2P21E, IS2P21D, IS2P21G, IS2P21F, IS2P21B, sgender, IS2G11, IS2G03, IS2G07, IS2G09, TOTWGTS)) %>%
reduce(rbind) %>%
as_tibble() %>%
mutate(`ICCS_year` = 2009) %>%     # survey year variable creation
select(`ICCS_year`, everything())
tbl2 <- files %>%
magrittr::extract(29:66) %>%      # filter to 2009 files only
map(~ .x %>%
load_files() %>%
select(COUNTRY, IDCNTRY, IDSTUD, IS2P21L, IS2P21I, IS2P21H, IS2P21K, IS2P21J, IS2P21A,
IS2P21C, IS2P21E, IS2P21D, IS2P21G, IS2P21F, IS2P21B, SGENDER, IS2G11, IS2G03, IS2G07, IS2G09, TOTWGTS)) %>%
reduce(rbind) %>%
as_tibble() %>%
mutate(`ICCS_year` = 2009) %>%     # survey year variable creation
select(`ICCS_year`, everything())
tbl1 %>%
count(GENDER)
tbl2 %>%
count(SGENDER)
# recode
tbl2 <- tbl2 %>%
mutate(FEMALE_bin = fct_collapse(SGENDER,
"0" = "(0) BOY",
"1" = "(1) GIRL""))
# confirm correct recode
tbl2 %>%
count(FEMALE_bin, SGENDER)
tbl2 %>%
count(SGENDER)
# recode
tbl2 <- tbl2 %>%
mutate(FEMALE_bin = fct_collapse(SGENDER,
"0" = "(0) BOY",
"1" = "(1) GIRL""))
# confirm correct recode
tbl2 %>%
count(FEMALE_bin, SGENDER)
# recode
tbl2 <- tbl2 %>%
mutate(FEMALE_bin = fct_collapse(SGENDER,
"0" = "(0) BOY",
"1" = "(1) GIRL"))
# confirm correct recode
tbl2 %>%
count(FEMALE_bin, SGENDER)
tbl2 %>%
count(SGENDER)
tbl2 %>%
count(SGENDER)
# recode
tbl2 <- tbl2 %>%
mutate(FEMALE_bin = fct_collapse(SGENDER,
"0" = "(0) BOY",
"1" = "(1) GIRL"))
# confirm correct recode
tbl2 %>%
count(FEMALE_bin, SGENDER)
tbl2 %>%
count(IS2G11)
# recode
tbl2 <- tbl2 %>%
mutate(BOOK_4 = fct_collapse(IS2G11,
"0 to 10" = "(1) 0-10 BOOKS",
"11-100" = c("(2) 11-25 BOOKS", "(3) 26-100 BOOKS"),
"101-200" = "(4) 101-200 BOOKS",
"201+" = c("(5) 201-500 BOOKS", "(6) MORE THAN 500 BOOKS")))
# confirm correct recode
tbl1 %>%
count(BOOK_4, IS2G11)
# recode
tbl2 <- tbl2 %>%
mutate(BOOK_4 = fct_collapse(IS2G11,
"0 to 10" = "(1) 0-10 BOOKS",
"11-100" = c("(2) 11-25 BOOKS", "(3) 26-100 BOOKS"),
"101-200" = "(4) 101-200 BOOKS",
"201+" = c("(5) 201-500 BOOKS", "(6) MORE THAN 500 BOOKS")))
# confirm correct recode
tbl2 %>%
count(BOOK_4, IS2G11)
tbl2 %>%
count(IS2G11)
# recode
tbl2 <- tbl2 %>%
mutate(BOOK_4 = fct_collapse(IS2G11,
"0 to 10" = "(1) 0-10 BOOKS",
"11-100" = c("(2) 11-25 BOOKS", "(3) 26-100 BOOKS"),
"101-200" = "(4) 101-200 BOOKS",
"201+" = c("(5) 201-500 BOOKS", "(6) MORE THAN 500 BOOKS")))
# confirm correct recode
tbl2 %>%
count(BOOK_4, IS2G11)
# recode
tbl1 <- tbl1 %>%
mutate(BSGBOOK_4 = fct_collapse(BSGBOOK,
"0 to 10 = c("(1) None", "(2) 1 - 10"),
"11-100" = c("(3) 11 - 50", "(4) 51 - 100"),
"101-200" = "(5) 101 - 200",
"201+" = "(6) More than 200)"))
# confirm correct recode
tbl1 %>%
count(BSGBOOK_4, BSGBOOK)
tbl1 %>%
count(BSGBOOK)
tbl1 %>%
count(BSGBOOK)
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE, fig.width = 10)
library(tidyverse)
library(readr)
library(purrr)
library(writexl)
# Chunk 2
# all files
files <- list.files("../data", full.names = TRUE)
# helper function to load files
load_files <- function(file) {
e <- new.env()
load(file, envir = e)
stopifnot(length(e) == 1)  # safety first
get(names(e)[1], envir = e)
}
tbl1 <- files %>%
magrittr::extract(1:28) %>%      # filter to 1999 files only
map(~ .x %>%
load_files() %>%
select(COUNTRY, IDCNTRY, IDSTUD, BS3B1, BS3B11, BS3B9, BS3B4, BS3B13,
BS3B2, BS3B6, BS3B10, BS3B8, BS3B5, BS3B12, BS3B3, GENDER,BSGBOOK, EXPEDUC, BSGEDUM, BSGEDUF, TOTWGT)) %>%
reduce(rbind) %>%
as_tibble() %>%
mutate(`ICCS_year` = 1999) %>%     # add survey year variable
select(`ICCS_year`, everything())
# Chunk 3
original_vars <- tbl1 %>%
select(BS3B1, BS3B11, BS3B9, BS3B4, BS3B13, BS3B2, BS3B6, BS3B10, BS3B8, BS3B5, BS3B12, BS3B3) %>%
colnames()
original_vars %>%
map(~ tbl1 %>% count(!!sym(.x)))
# Chunk 4
# recode
tbl1 <- tbl1 %>%
mutate(BS3B1_binary = fct_collapse(BS3B1,
"not important" = c("(1) not important", "(2) somewhat unimportant"),
"important"     = c("(3) somewhat important", "(4) very important")))
# confirm correct recode
tbl1 %>%
count(BS3B1, BS3B1_binary)
# Chunk 5
tbl1 <-tbl1 %>%
mutate_at(vars(BS3B1, BS3B11, BS3B9, BS3B4, BS3B13, BS3B2, BS3B6, BS3B10, BS3B8, BS3B5, BS3B3),
funs(bin = fct_collapse(.,
"not important"= c("(1) not important", "(2) somewhat unimportant"),
"important"    = c("(3) somewhat important", "(4) very important")))
)
# Chunk 6
# troubleshoot
tbl1 %>% count(BS3B12)
# recode
tbl1 <- tbl1 %>%
mutate(BS3B12_bin = fct_collapse(BS3B12,
"not important" = c("(1) not importnat", "(2) somewhat unimportant"),
"important"     = c("(3) somewhat important", "(4) very important"))
)
# Chunk 7
bin_vars <- original_vars %>%
paste0("_bin")
map2(original_vars, bin_vars, ~ tbl1 %>% count(!!sym(.x), !!sym(.y)))
# Chunk 8
tbl1 %>%
count(GENDER)
# Chunk 9
# recode
tbl1 <- tbl1 %>%
mutate(FEMALE_bin = fct_collapse(GENDER,
"0" = "(0) Male",
"1" = "(1) Female"))
# confirm correct recode
tbl1 %>%
count(FEMALE_bin, GENDER)
tbl1 %>%
count(BSGBOOK)
# recode
tbl1 <- tbl1 %>%
mutate(BSGBOOK_4 = fct_collapse(BSGBOOK,
"0 to 10 = c("(1) None", "(2) 1 - 10"),
"11-100" = c("(3) 11 - 50", "(4) 51 - 100"),
"101-200" = "(5) 101 - 200",
"201+" = "(6) More than 200)"))
# confirm correct recode
tbl1 %>%
count(BSGBOOK_4, BSGBOOK)
tbl2 %>%
count(IS2G11)
